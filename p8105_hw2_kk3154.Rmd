---
title: "p8105_hw2_kk3154"
author: "Kristen King"
date: "10/9/2021"
output: github_document
---

```{r, echo = FALSE, message = FALSE}
library(tidyverse)
library(readxl)
```

## Problem 1 - Mr. Trash Wheel data

1.1 - Reading and cleaning the Mr. Trash Wheel excel data sheet:

* omitting non-data entries

* using reasonable variable names

* omitting rows with non-dumpster specific data

* round number of sports balls to the nearest integer

* NA'ing the date for one observation in January 2020 with date '1900-01-20'

```{r}
trash_df = read_excel(
  "data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
  sheet = "Mr. Trash Wheel", 
  range = "A2:N535") %>% 
  janitor::clean_names() %>% 
  drop_na(dumpster, month) %>% 
  mutate(sports_balls = round(sports_balls))
```

1.2 - Reading and cleaning precipitation data:

* years: 2018-2019
  
* omit rows without precip data
  
* add variable for year

```{r}
precip_18 = read_excel(
  "data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
  sheet = "2018 Precipitation",
  skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2018)

precip_19 = read_excel(
  "data/Trash-Wheel-Collection-Totals-7-2020-2.xlsx",
  sheet = "2019 Precipitation",
  skip = 1) %>% 
  janitor::clean_names() %>% 
  drop_na(month) %>% 
  mutate(year = 2019)
```

* combine precipitation datasets

* convert month to a character variable

```{r}
precip_df = 
  bind_rows(precip_18, precip_19) %>% 
  rename(precip_tot = total) %>% 
  mutate(month = month.name[month])
```

The Mr. Trash Wheel dataset contains `r ncol(trash_df)` variables of data on how much trash of various types (plastic bottles, cigarette butts, grocery bags, etc.) by weight and volume was collected by the Trash Wheel in Baltimore's Inner Harbor. Data are collected and reported each time a dumpster is filled, and there were `r nrow(trash_df)` dumpster observation rows recorded in this dataset between `r min(pull(trash_df, year))` and `r max(pull(trash_df, year))`. The amount of trash can be impacted by rainfall. The precipitation dataset contains precipitation totals in Baltimore (in inches) by month, with a total of `r ncol(precip_df)` variables in the dataset and `r nrow(precip_df)` observations between `r min(pull(precip_df, year))` and `r max(pull(precip_df, year))`. The total precipitation in 2018 was `r sum(pull(filter(precip_df, year == 2018), precip_tot))` inches. The median number of sports balls in a dumpster in 2019 was `r median(pull(filter(trash_df, year == 2019), sports_balls))` balls.


## Problem 2 - FiveThirtyEight Data

2.1 - Importing and Cleaning `pols-month.csv` data:

* Breaking up the variable `mon` into integer variables `year`, `month`, and `day`

* replacing month number with month name

* creating a `president` variable taking values `gop` and `dem`

* removing `prez_dem` and `prez_gop`

* removing the `day` variable

```{r}
pols_df = read_csv("data/pols-month.csv") %>% 
  separate(mon, into = c("year", "month", "day"), "-") %>% 
  mutate(year = as.integer(year), month = as.integer(month), day = as.integer(day)) %>% 
  mutate(month = month.name[month]) %>% 
  mutate(president = case_when(
    prez_dem == 1 ~ "dem",
    prez_gop == 1 ~ "gop") %>% 
      as.factor()) %>% 
  select(-prez_dem, -prez_gop, -day)
```

2.2 - Importing and cleaning the `snp.csv` data using similar steps as above.

Also arrange with `year` and `month` as the leading columns.

```{r}
snp_df = read_csv("data/snp.csv") %>% 
  mutate(date = lubridate::mdy(date)) %>% 
  separate(date, into = c("year", "month", "day"), "-") %>% 
  mutate(year = as.integer(year), month = as.integer(month), day = as.integer(day)) %>% 
  mutate(year = ifelse(year > 2021, year - 100, year)) %>% 
  mutate(month = month.name[month]) %>% 
  select(-day) %>% 
  relocate(year, month)
```

2.3 - Tidying the `unemployment` data.

* Switching from wide to long format
* ensuring key variables have the same name
* ensuring key variables take the same values

Goal: to be able to merge the unemployment data with pols and snp datasets.

```{r}
unemp_df = read_csv("data/unemployment.csv") %>% 
  pivot_longer(
    Jan:Dec,
    names_to = "month",
    values_to = "unemp_pct"
  ) %>% 
  janitor::clean_names() %>% 
  mutate(month = month.name[match(month, month.abb)])
```

2.4 - Joining the data

1) merging `snp` into `pols`

2)  merging `unemployment` into the result from the first join

```{r}
df_538 = 
  left_join(pols_df, snp_df, by = c("year", "month")) %>% 
  left_join(unemp_df, by = c("year", "month"))
```

This FiveThirtyEight dataset was constructed by merging three component data files. The first data file,  `pols-month.csv`, contained information about the political party affiliations (president, senators, and representatives) during each month of each year from `r min(pull(pols_df, year))` through `r max(pull(precip_df, year))`. The `snp.csv` data file contained information on the S&P stock market index closing value on the first business date of each month from `r min(pull(snp_df, year))` through `r max(pull(snp_df, year))`. The `unemployment.csv` file contained the unemployment percentage by month from from `r min(pull(unemp_df, year))` through `r max(pull(unemp_df, year))`. The `df_538` dataset that resulted from merging these 3 datasets on a year-month key contains `r nrow(df_538)` observations and `r ncol(df_538)` variables, of which month + year, president (dem vs. gop), close (S&P market closing value), and unemp_pct (% unemployed) might be of interest for analysis. Left joins were used beginning with the dataset with the oldest observations to preserve instances where data were available for some but not all elements. Data is complete for `r nrow(drop_na(df_538))` observations between `r min(pull(drop_na(df_538), year))` and `r max(pull(drop_na(df_538), year))`.
